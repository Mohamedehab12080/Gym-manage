
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>نظام إدارة أعضاء النادي الرياضي</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Modern CSS Variables */
        :root {
            --primary: #4361ee;
            --primary-dark: #3a56d4;
            --secondary: #6c757d;
            --success: #4cc9f0;
            --danger: #e5383b;
            --warning: #f9c74f;
            --info: #4895ef;
            --light: #f8f9fa;
            --dark: #212529;
            --gray-50: #f9fafb; /* Added missing variable */
            --gray-100: #f8f9fa;
            --gray-200: #e9ecef;
            --gray-300: #dee2e6;
            --gray-400: #ced4da;
            --gray-500: #adb5bd;
            --gray-600: #6c757d;
            --gray-700: #495057;
            --gray-800: #343a40;
            --gray-900: #212529;
            --border-radius: 12px;
            --box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s ease;
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Cairo', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--gray-800);
            background-color: #f5f7f9;
            padding: 20px;
            direction: rtl;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Header Styles */
        header {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            padding: 30px;
            border-radius: var(--border-radius);
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }

        header h1 {
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 2.2rem;
            text-align: right;
        }

        .stats {
            display: flex;
            gap: 20px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: var(--border-radius);
            text-align: center;
            min-width: 180px;
            transition: var(--transition);
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-number {
            display: block;
            font-size: 2.5rem;
            font-weight: 700;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Actions Panel */
        .actions-panel {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
            font-size: 0.95rem;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: white;
        }

        .btn-secondary:hover {
            background-color: var(--gray-600);
            transform: translateY(-2px);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-danger:hover {
            background-color: #c1121f;
            transform: translateY(-2px);
        }

        .btn-edit {
            background-color: var(--warning);
            color: var(--dark);
            padding: 8px 16px;
            font-size: 0.85rem;
        }
        .btn-info {
            background-color: var(--info);
            color: white;
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-info:hover {
            background-color: #3a7bd5;
            transform: translateY(-2px);
        }

        .btn-edit:hover {
            background-color: #f8961e;
            transform: translateY(-2px);
        }
        .btn.disabled {
            opacity: 0.6;
            cursor: not-allowed;
            pointer-events: none;
        }
        .filters {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .filters select, .filters input {
            padding: 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
            background-color: white;
            transition: var(--transition);
        }

        .filters select:focus, .filters input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        #searchInput {
            min-width: 250px;
            padding-right: 40px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 95% center;
        }

        #searchNumber {
            min-width: 250px;
            padding-right: 40px;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='%236c757d' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Ccircle cx='11' cy='11' r='8'%3E%3C/circle%3E%3Cline x1='21' y1='21' x2='16.65' y2='16.65'%3E%3C/line%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: 95% center;
        }
        /* Table Styles */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        th, td {
            padding: 18px 15px;
            text-align: right;
            border-bottom: 1px solid var(--gray-200);
        }

        th {
            background-color: var(--gray-100);
            font-weight: 600;
            position: sticky;
            top: 0;
            color: var(--gray-700);
        }

        tr {
            transition: var(--transition);
        }

        tr:hover {
            background-color: var(--gray-50);
        }

        .member-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            object-fit: cover;
            background-color: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            font-size: 0.9rem;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .status-active {
            background-color: rgba(76, 201, 240, 0.15);
            color: #168aad;
        }

        .status-inactive {
            background-color: rgba(229, 56, 59, 0.15);
            color: #a4161a;
        }

        .membership-badge {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }

        .membership-NORMAL {
            background-color: rgba(67, 97, 238, 0.15);
            color: var(--primary-dark);
        }

        .membership-PREMIUM {
            background-color: rgba(249, 199, 79, 0.15);
            color: #f8961e;
        }

        .membership-VIP {
            background-color: rgba(168, 85, 247, 0.15);
            color: #7b2cbf;
        }

        .actions-cell {
            display: flex;
            gap: 10px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            overflow: auto;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            border-radius: var(--border-radius);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.25);
            animation: modalFadeIn 0.3s;
            overflow: hidden;
        }

        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--gray-200);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: var(--gray-100);
        }

        .modal-header h2 {
            margin: 0;
            color: var(--dark);
            font-weight: 600;
        }

        .close {
            color: var(--gray-500);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: var(--transition);
        }

        .close:hover {
            color: var(--dark);
            transform: rotate(90deg);
        }

        form {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--gray-700);
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 1rem;
            transition: var(--transition);
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-container input[type="checkbox"] {
            width: auto;
            transform: scale(1.2);
        }

        .checkbox-label {
            margin: 0;
            font-weight: normal;
        }

        .form-actions {
            display: flex;
            justify-content: flex-start;
            gap: 10px;
            margin-top: 30px;
        }

        /* Footer */
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: var(--gray-600);
        }

        /* Loading Spinner */
        .spinner {
            border: 4px solid var(--gray-200);
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-message {
            color: var(--danger);
            text-align: center;
            padding: 20px;
            background-color: rgba(229, 56, 59, 0.1);
            border-radius: var(--border-radius);
            margin: 10px 0;
            border-right: 4px solid var(--danger);
        }

        /* Image Preview */
        .image-preview {
            width: 100px;
            height: 100px;
            border-radius: var(--border-radius);
            object-fit: cover;
            margin-top: 10px;
            display: none;
            border: 1px solid var(--gray-300);
            box-shadow: var(--box-shadow);
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-button {
            padding: 12px 18px;
            background: var(--primary);
            color: white;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: var(--transition);
        }

        .file-input-button:hover {
            background: var(--primary-dark);
        }

        .file-input-container input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        /* Notification System */
        .notification-container {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }

        .notification {
            padding: 16px 20px;
            border-radius: var(--border-radius);
            color: white;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s forwards, fadeOut 0.5s forwards 2.7s;
            transform: translateX(-100%);
            opacity: 0;
        }

        .notification-success {
            background: var(--success);
            border-right: 4px solid #168aad;
        }

        .notification-error {
            background: var(--danger);
            border-right: 4px solid #a4161a;
        }

        .notification-warning {
            background: var(--warning);
            color: var(--dark);
            border-right: 4px solid #f8961e;
        }

        .notification-info {
            background: var(--info);
            border-right: 4px solid var(--primary-dark);
        }

        .notification-icon {
            font-size: 1.2rem;
        }

        .notification-content {
            flex: 1;
        }

        .notification-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .notification-message {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .notification-close {
            background: transparent;
            border: none;
            color: inherit;
            cursor: pointer;
            font-size: 1.1rem;
            opacity: 0.7;
            transition: var(--transition);
        }

        .notification-close:hover {
            opacity: 1;
        }

        @keyframes slideIn {
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeOut {
            to {
                opacity: 0;
            }
        }

        /* Member Profile Styles */
        .profile-container {
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        .profile-header {
            display: flex;
            gap: 25px;
            align-items: flex-start;
        }

        .profile-image {
            flex-shrink: 0;
            width: 180px;
            height: 180px;
            border-radius: 50%;
            object-fit: cover;
            background-color: var(--gray-200);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--gray-600);
            font-size: 4rem;
            box-shadow: var(--box-shadow);
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-size: 1.8rem;
            margin-bottom: 10px;
            color: var(--dark);
        }

        .profile-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.85rem;
            color: var(--gray-600);
            margin-bottom: 5px;
        }

        .detail-value {
            font-weight: 500;
            color: var(--gray-800);
        }

        /* Updated Subscription Card Styles */
        .subscription-card {
            background: linear-gradient(135deg, #6366f1, #4f46e5);
            color: white;
            padding: 25px;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .subscription-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.2);
        }

        .subscription-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 60%);
            transform: rotate(15deg);
            pointer-events: none;
        }

        .subscription-title {
            font-size: 1.4rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            position: relative;
        }

        .subscription-title i {
            font-size: 1.6rem;
            background: rgba(255, 255, 255, 0.15);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(10px);
        }

        .subscription-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
            position: relative;
        }

        .subscription-details .detail-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 12px;
            backdrop-filter: blur(5px);
        }

        .subscription-details .detail-label {
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
            color: #000000;      /* Black color */
            font-weight: bold;   /* Bold text */
        }

        .subscription-details .detail-value {
            font-size: 1.1rem;
            font-weight: 600;
        }

        .subscription-status {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
            background-color: rgba(255, 255, 255, 0.2);
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
        }

        .status-active {
            background-color: rgba(16, 185, 129, 0.3);
            color: #fff;
        }

        .status-pending {
            background-color: rgba(245, 158, 11, 0.3);
            color: #fff;
        }

        .status-expired {
            background-color: rgba(239, 68, 68, 0.3);
            color: #fff;
        }

        @media (max-width: 768px) {
            .stats {
                flex-direction: column;
                gap: 15px;
            }

            .stat-card {
                min-width: auto;
            }

            .actions-panel {
                flex-direction: column;
                align-items: stretch;
            }

            .filters {
                flex-direction: column;
                width: 100%;
            }

            #searchInput {
                min-width: auto;
            }
            #searchNumber {
                min-width: auto;
            }
            th, td {
                padding: 12px 10px;
            }

            .modal-content {
                width: 95%;
                margin: 10% auto;
            }

            .notification-container {
                right: 20px;
                left: 20px;
                max-width: none;
            }

            .profile-header {
                flex-direction: column;
            }

            .profile-details, .subscription-details {
                grid-template-columns: 1fr;
            }
        }
        /* New styles for date filter and buttons */
        .session-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .session-actions {
            display: flex;
            gap: 10px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-filter input {
            padding: 8px 12px;
            border: 1px solid var(--gray-300);
            border-radius: var(--border-radius);
            font-size: 0.9rem;
        }

        .btn-sm {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-success {
            background-color: #2ecc71;
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .btn-purple {
            background-color: #9b59b6;
            color: white;
        }

        .btn-purple:hover {
            background-color: #8e44ad;
            transform: translateY(-2px);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }

        .nav-links {
            display: flex;
            gap: 25px;
        }

        .nav-links a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            padding: 8px 16px;
            border-radius: var(--border-radius);
        }

        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .nav-links a.active {
            background: rgba(255, 255, 255, 0.2);
        }

        /* Mobile menu button (hidden by default) */
        .menu-toggle {
            display: none;
            flex-direction: column;
            justify-content: space-around;
            width: 30px;
            height: 25px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
        }

        .menu-toggle span {
            width: 100%;
            height: 3px;
            background-color: white;
            border-radius: 5px;
            transition: var(--transition);
        }

        /* Main content area */
        main {
            flex: 1;
            padding: 40px 0;
        }
        /* Footer Styles */
        footer {
            background: var(--gray-900);
            color: white;
            padding: 60px 0 30px;
            margin-top: auto;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 40px;
            margin-bottom: 40px;
        }

        .footer-column h3 {
            font-size: 1.3rem;
            margin-bottom: 20px;
            color: white;
        }

        .footer-column p {
            color: var(--gray-400);
            margin-bottom: 20px;
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 12px;
        }

        .footer-links a {
            color: var(--gray-400);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-links a:hover {
            color: white;
        }

        .social-links {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .social-links a {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gray-700);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            transition: var(--transition);
        }

        .social-links a:hover {
            background: var(--primary);
            transform: translateY(-3px);
        }

        .copyright {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid var(--gray-700);
            color: var(--gray-400);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .menu-toggle {
                display: flex;
            }

            .nav-links {
                position: fixed;
                top: 70px;
                right: -100%;
                flex-direction: column;
                background: linear-gradient(135deg, var(--primary), var(--primary-dark));
                width: 100%;
                text-align: center;
                transition: 0.3s;
                box-shadow: 0 10px 27px rgba(0, 0, 0, 0.05);
                padding: 20px 0;
                gap: 0;
            }

            .nav-links.active {
                right: 0;
            }

            .nav-links a {
                padding: 15px;
                display: block;
            }

            .nav-links a:hover {
                background: rgba(255, 255, 255, 0.1);
            }
        }

    </style>

    <style>
        /* Enhanced table styles */
        .table-container {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--box-shadow);
            overflow-x: auto;
            margin-top: 15px;
        }

        #sessionsTable {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }

        #sessionsTable th {
            background-color: var(--primary);
            color: white;
            font-weight: 600;
            padding: 16px 12px;
            text-align: right;
            position: sticky;
            top: 0;
        }

        #sessionsTable th:first-child {
            border-top-right-radius: var(--border-radius);
        }

        #sessionsTable th:last-child {
            border-top-left-radius: var(--border-radius);
        }

        #sessionsTable td {
            padding: 14px 12px;
            border-bottom: 1px solid var(--gray-200);
            vertical-align: middle;
        }

        #sessionsTable tr:last-child td {
            border-bottom: none;
        }

        #sessionsTable tr:hover {
            background-color: var(--gray-50);
        }

        /* Session date styling */
        .session-date {
            font-weight: 500;
            color: var(--gray-800);
        }

        /* Remaining sessions styling */
        .remaining-sessions {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .remaining-high {
            background-color: rgba(46, 204, 113, 0.15);
            color: #27ae60;
        }

        .remaining-medium {
            background-color: rgba(241, 196, 15, 0.15);
            color: #f39c12;
        }

        .remaining-low {
            background-color: rgba(231, 76, 60, 0.15);
            color: #c0392b;
        }

        /* Actions cell styling */
        .session-actions-cell {
            display: flex;
            gap: 8px;
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-delete {
            background-color: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
        }

        .btn-delete:hover {
            background-color: #e74c3c;
            color: white;
            transform: scale(1.1);
        }

        /* Empty state styling */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray-500);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .empty-state p {
            margin: 0;
            font-size: 1.1rem;
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            #sessionsTable {
                font-size: 0.9rem;
            }

            #sessionsTable th,
            #sessionsTable td {
                padding: 10px 8px;
            }

            .session-actions-cell {
                flex-direction: column;
                gap: 5px;
            }

            .btn-icon {
                width: 28px;
                height: 28px;
                font-size: 0.8rem;
            }
        }

        /* Filter styling improvements */
        .date-filter {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 12px;
            border-radius: var(--border-radius);
            border: 1px solid var(--gray-300);
        }

        .date-filter input {
            border: none;
            padding: 4px;
            font-size: 0.9rem;
        }

        .date-filter input:focus {
            outline: none;
        }

        .date-filter span {
            color: var(--gray-500);
            font-size: 0.9rem;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
<div class="container">
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    <!-- Navigation will be loaded here -->
    <div id="navbar">
        <div style="text-align: center; padding: 20px; background: var(--primary); color: white;">
            <div class="loading"></div> جاري تحميل القائمة...
        </div>
    </div>

    <header>
        <h1>نظام إدارة أعضاء النادي الرياضي</h1>
        <div class="stats">
            <div class="stat-card">
                <span class="stat-number" id="totalMembers">0</span>
                <span class="stat-label">إجمالي الأعضاء</span>
            </div>
            <div class="stat-card">
                <span class="stat-number" id="activeMembers">0</span>
                <span class="stat-label">الأعضاء النشطين</span>
            </div>
        </div>
    </header>

    <main>
        <div class="actions-panel">
            <button class="btn btn-primary" onclick="openMemberModal()">
                <i class="fas fa-plus"></i> إضافة عضو جديد
            </button>
            <div class="filters">
                <select id="statusFilter" onchange="filterMembers()">
                    <option value="all">جميع الأعضاء</option>
                    <option value="active">النشطين فقط</option>
                    <option value="inactive">غير النشطين فقط</option>
                </select>
                <input type="text" id="searchInput" placeholder="البحث بالاسم" onkeyup="searchMembers()">
                <input type="text" id="searchNumber" placeholder="البحث بالرقم" onkeyup="searchMembers()">

            </div>
        </div>

        <div class="table-container">
            <table id="membersTable">
                <thead>
                <tr>
                    <th>المعرف</th>
                    <th>الصورة</th>
                    <th>الاسم الكامل</th>
                    <th>تاريخ الانضمام</th>
                    <th>الهاتف</th>
                    <th>الحالة</th>
                    <th>نوع العضوية</th>
                    <th>الإجراءات</th>
                </tr>
                </thead>
                <tbody id="membersTableBody">
                <tr>
                    <td colspan="8" style="text-align: center;">
                        <div class="spinner" id="loadingSpinner"></div>
                        <div>جاري تحميل الأعضاء...</div>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </main>

    <!-- Member Form Modal -->
    <div id="memberModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">إضافة عضو جديد</h2>
                <span class="close" onclick="closeMemberModal()">&times;</span>
            </div>
            <form id="memberForm" onsubmit="handleFormSubmit(event)" enctype="multipart/form-data">
                <input type="hidden" id="memberId" name="id">
                <div class="form-group">
                    <label for="fullName">الاسم الكامل *</label>
                    <input type="text" id="fullName" name="fullName" required>
                </div>
                <div class="form-group">
                    <label for="phone">رقم الهاتف *</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="membershipType">نوع العضوية</label>
                    <select id="membershipType" name="membershipType">
                        <option value="NORMAL">عادي</option>
                        <option value="PREMIUM">مميز</option>
                        <option value="VIP">VIP</option>
                    </select>
                </div>
                <div class="form-group">
                    <div class="checkbox-container">
                        <input type="checkbox" id="status" name="status" checked>
                        <label for="status" class="checkbox-label">عضو نشط</label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="imageFile">صورة الملف الشخصي</label>
                    <div class="file-input-container">
                        <div class="file-input-button">
                            <i class="fas fa-upload"></i> اختيار صورة
                        </div>
                        <input type="file" id="imageFile" name="imageFile" accept="image/*" onchange="previewImage(this)">
                    </div>
                    <img id="imagePreview" class="image-preview" alt="معاينة الصورة">
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeMemberModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">حفظ العضو</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Member Profile Modal -->
    <div id="memberProfileModal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 1000px;">
            <div class="modal-header">
                <h2>الملف الشخصي للعضو</h2>
                <span class="close" onclick="closeProfileModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="profile-container">
                    <div class="profile-header">
                        <div class="profile-image" id="profileImage">
                            <i class="fas fa-user"></i>
                        </div>
                        <div class="profile-info">
                            <h2 class="profile-name" id="profileName">جاري التحميل...</h2>
                            <div class="profile-details">
                                <div class="detail-item">
                                    <span class="detail-label">رقم العضو</span>
                                    <span class="detail-value" id="profileId">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">الهاتف</span>
                                    <span class="detail-value" id="profilePhone">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">تاريخ الانضمام</span>
                                    <span class="detail-value" id="profileJoinDate">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">الحالة</span>
                                    <span class="detail-value" id="profileStatus">-</span>
                                </div>
                                <div class="detail-item">
                                    <span class="detail-label">نوع العضوية</span>
                                    <span class="detail-value" id="profileMembership">-</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Subscription Card -->
                    <div class="subscription-card">
                        <h3 class="subscription-title">
                            <i class="fas fa-tag"></i> الاشتراك الحالي
                        </h3>
                        <div class="subscription-details">
                            <div class="detail-item">
                                <span class="detail-label">العرض</span>
                                <span class="detail-value" id="subscriptionOffer">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">تاريخ البدء</span>
                                <span class="detail-value" id="subscriptionStart">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">تاريخ الانتهاء</span>
                                <span class="detail-value" id="subscriptionEnd">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">الجلسات المتبقية</span>
                                <span class="detail-value" id="subscriptionRemaining">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">سعر الجلسات</span>
                                <span class="detail-value" id="subscriptionPrice">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">الحالة</span>
                                <span class="subscription-status" id="subscriptionStatus">-</span>
                            </div>
                        </div>
                        <div style="margin-top: 15px;">
                            <button class="btn btn-purple btn-sm" onclick="openCreateMemberOfferModal()">
                                <i class="fas fa-plus-circle"></i> إنشاء عرض جديد
                            </button>
                        </div>
                    </div>

                    <div class="session-header">
                        <h3><i class="fas fa-dumbbell"></i> جلسات التمرين</h3>
                        <div class="session-actions">
                            <div class="date-filter">
                                <input type="date" id="startDateFilter" onchange="filterSessionsByDate()">
                                <span>إلى</span>
                                <input type="date" id="endDateFilter" onchange="filterSessionsByDate()">
                            </div>
                            <button class="btn btn-success btn-sm" onclick="openCreateWorkoutSessionModal()">
                                <i class="fas fa-plus"></i> إضافة جلسة
                            </button>
                        </div>
                    </div>
                    <div class="table-container">
                        <table id="sessionsTable">
                            <thead>
                            <tr>
                                <th>تاريخ الجلسة</th>
                                <th>الجلسات المتبقية</th>
                                <th>الإجراءات</th>
                            </tr>
                            </thead>
                            <tbody id="sessionsTableBody">
                            <tr>
                                <td colspan="3" style="text-align: center;">
                                    <div class="spinner" id="profileLoadingSpinner"></div>
                                    <div>جاري تحميل الجلسات...</div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Workout Session Modal -->
    <div id="createWorkoutSessionModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>إنشاء جلسة تمرين</h2>
                <span class="close" onclick="closeCreateWorkoutSessionModal()">&times;</span>
            </div>
            <form id="workoutSessionForm" onsubmit="handleWorkoutSessionSubmit(event)">
                <input type="hidden" id="workoutSessionMemberId">
                <div class="form-group">
                    <label for="sessionDate">تاريخ الجلسة *</label>
                    <input type="date" id="sessionDate" name="sessionDate" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateWorkoutSessionModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">إنشاء الجلسة</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Member Offer Modal -->
    <div id="createMemberOfferModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h2>إنشاء عرض للعضو</h2>
                <span class="close" onclick="closeCreateMemberOfferModal()">&times;</span>
            </div>
            <form id="memberOfferForm" onsubmit="handleMemberOfferSubmit(event)">
                <input type="hidden" id="memberOfferMemberId">
                <div class="form-group">
                    <label for="offerId">العرض *</label>
                    <select id="offerId" name="offerId" required>
                        <option value="">اختر عرضًا</option>
                        <!-- Options will be populated dynamically -->
                    </select>
                </div>
                <div class="form-group">
                    <label for="memberOfferStartDate">تاريخ البدء *</label>
                    <input type="date" id="memberOfferStartDate" name="startDate" required>
                </div>
                <div class="form-group">
                    <label for="memberOfferEndDate">تاريخ الانتهاء *</label>
                    <input type="date" id="memberOfferEndDate" name="endDate" required>
                </div>
                <div class="form-group">
                    <label for="remainedSessions">الجلسات المتبقية *</label>
                    <input type="number" id="remainedSessions" name="remainedSessions" min="1" required>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeCreateMemberOfferModal()">إلغاء</button>
                    <button type="submit" class="btn btn-primary">إنشاء العرض</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Footer will be loaded here -->
<div id="footer">
    <div style="text-align: center; padding: 20px; background: var(--gray-900); color: white;">
        <div class="loading"></div> جاري تحميل التذييل...
    </div>
</div>

<script>
    // Global variables
    let allMembers = [];
    let currentEditingId = null;
    let profileMemberData = null;
    let profileWorkoutSessions = [];
    let profileMemberOffers = [];
    let allOffers = [];
    let filteredSessions = [];

    // DOM Content Loaded
    document.addEventListener('DOMContentLoaded', function() {
        loadMembers();
        // Set default dates for filters to current month
        const today = new Date();
        const firstDayOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
        const lastDayOfMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0);

        document.getElementById('startDateFilter').valueAsDate = firstDayOfMonth;
        document.getElementById('endDateFilter').valueAsDate = lastDayOfMonth;
    });

    // Notification System
    function showNotification(type, title, message, duration = 3000) {
        const notificationContainer = document.getElementById('notificationContainer');
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;

        let iconClass = 'fa-info-circle';
        switch(type) {
            case 'success': iconClass = 'fa-check-circle'; break;
            case 'error': iconClass = 'fa-exclamation-circle'; break;
            case 'warning': iconClass = 'fa-exclamation-triangle'; break;
            case 'info': iconClass = 'fa-info-circle'; break;
        }

        notification.innerHTML = `
            <i class="fas ${iconClass} notification-icon"></i>
            <div class="notification-content">
                <div class="notification-title">${title}</div>
                <div class="notification-message">${message}</div>
            </div>
            <button class="notification-close" onclick="this.parentElement.remove()">
                <i class="fas fa-times"></i>
            </button>
        `;

        notificationContainer.appendChild(notification);

        // Auto remove after duration
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, duration);
    }

    // Load all members from the server
    async function loadMembers() {
        try {
            showLoading(true);
            // Call the active members endpoint that returns JSON
            const response = await fetch('/api/members/active');

            if (!response.ok) {
                throw new Error(`Server returned ${response.status}: ${response.statusText}`);
            }

            // Parse JSON response
            const members = await response.json();
            console.log('Loaded members:', members);

            allMembers = members;
            renderMembersTable(allMembers);
            updateStats();

            showNotification('success', 'نجاح', 'تم تحميل الأعضاء بنجاح');
        } catch (error) {
            console.error('Error loading members:', error);
            document.getElementById('membersTableBody').innerHTML =
                '<tr><td colspan="8" class="error-message">حدث خطأ في تحميل الأعضاء. يرجى التحقق من وحدة التحكم للتفاصيل.</td></tr>';

            showNotification('error', 'خطأ', 'فشل في تحميل الأعضاء. يرجى المحاولة مرة أخرى.');
        } finally {
            showLoading(false);
        }
    }

    // Show/hide loading spinner
    function showLoading(show) {
        const spinner = document.getElementById('loadingSpinner');
        if (spinner) {
            spinner.style.display = show ? 'block' : 'none';
        }
    }

    // Render members table
    function renderMembersTable(members) {
        const tableBody = document.getElementById('membersTableBody');

        if (!members || !Array.isArray(members)) {
            tableBody.innerHTML = '<tr><td colspan="8" class="error-message">تنسيق بيانات الأعضاء غير صالح</td></tr>';
            return;
        }

        if (members.length === 0) {
            tableBody.innerHTML = '<tr><td colspan="8" style="text-align: center;">لم يتم العثور على أعضاء</td></tr>';
            return;
        }

        tableBody.innerHTML = '';

        members.forEach(member => {
            const row = document.createElement('tr');

            // Use imageUrl for display instead of imageData
            const imageSrc = member.imageUrl || '';

            row.innerHTML = `
                <td>${member.id || 'غير متاح'}</td>
                <td>
                    <div class="member-avatar">
                        ${imageSrc
                ? `<img src="${imageSrc}" alt="${member.fullName}" class="member-avatar" style="width: 45px; height: 45px; border-radius: 50%; object-fit: cover;">`
                : `<i class="fas fa-user"></i>`
            }
                    </div>
                </td>
                <td>${member.fullName || 'غير متاح'}</td>
                <td>${member.joinDate || 'غير متاح'}</td>
                <td>${member.phone || 'غير متاح'}</td>
                <td><span class="status-badge ${member.status ? 'status-active' : 'status-inactive'}">${member.status ? 'نشط' : 'غير نشط'}</span></td>
                <td><span class="membership-badge membership-${member.membershipType || 'NORMAL'}">${member.membershipType || 'عادي'}</span></td>
                <td class="actions-cell">
                    <button class="btn btn-edit" onclick="editMember(${member.id})">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button class="btn btn-danger" onclick="deleteMember(${member.id})">
                        <i class="fas fa-trash"></i>
                    </button>
                    <button class="btn btn-info" onclick="viewMemberProfile(${member.id})">
                        <i class="fas fa-user"></i> الملف
                    </button>
                </td>
            `;

            tableBody.appendChild(row);
        });
    }

    // Update statistics
    function updateStats() {
        // Total members
        const totalCount = allMembers.length;
        document.getElementById('totalMembers').textContent = totalCount;

        // Active members count
        const activeCount = allMembers.filter(member => member.status).length;
        document.getElementById('activeMembers').textContent = activeCount;
    }

    // Filter members based on status
    function filterMembers() {
        const filterValue = document.getElementById('statusFilter').value;

        let filteredMembers = allMembers;
        if (filterValue === 'active') {
            filteredMembers = allMembers.filter(member => member.status);
        } else if (filterValue === 'inactive') {
            filteredMembers = allMembers.filter(member => !member.status);
        }

        renderMembersTable(filteredMembers);
    }

    // Search members
    function searchMembers() {
        const searchValue = document.getElementById('searchInput').value.toLowerCase();
        const searchNumber = document.getElementById('searchNumber').value.toLowerCase();

        const filteredMembers = allMembers.filter(member => {
            const nameMatch = searchValue ? (member.fullName && member.fullName.toLowerCase().includes(searchValue)) : true;
            const phoneMatch = searchNumber ? (member.phone && member.phone.toLowerCase().includes(searchNumber)) : true;

            return nameMatch && phoneMatch;
        });

        renderMembersTable(filteredMembers);
    }

    // Preview selected image
    function previewImage(input) {
        const preview = document.getElementById('imagePreview');
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
            }
            reader.readAsDataURL(input.files[0]);
        } else {
            preview.style.display = 'none';
        }
    }

    function openMemberModal(member = null) {
        const modal = document.getElementById('memberModal');
        const modalTitle = document.getElementById('modalTitle');
        const form = document.getElementById('memberForm');
        const preview = document.getElementById('imagePreview');

        if (member) {
            // Editing existing member
            modalTitle.textContent = 'تعديل العضو';
            currentEditingId = member.id;
            document.getElementById('memberId').value = member.id;
            document.getElementById('fullName').value = member.fullName || '';
            document.getElementById('phone').value = member.phone || '';
            document.getElementById('membershipType').value = member.membershipType || 'NORMAL';
            document.getElementById('status').checked = member.status || false;

            // Show existing image using imageUrl
            if (member.imageUrl) {
                preview.src = member.imageUrl;
                preview.style.display = 'block';
            } else {
                preview.style.display = 'none';
            }
        } else {
            // Creating new member
            modalTitle.textContent = 'إضافة عضو جديد';
            currentEditingId = null;
            form.reset();
            preview.style.display = 'none';
        }

        modal.style.display = 'block';
    }

    // Edit a member
    async function editMember(id) {
        try {
            const response = await fetch(`/api/members/${id}`);
            if (!response.ok) {
                throw new Error(`Server returned ${response.status}: ${response.statusText}`);
            }

            const member = await response.json();
            openMemberModal(member);

            showNotification('info', 'معلومات', 'جاري تحميل تفاصيل العضو...');
        } catch (error) {
            console.error('Error fetching member:', error);
            showNotification('error', 'خطأ', 'فشل في تحميل تفاصيل العضو: ' + error.message);
        }
    }

    // Close member modal
    function closeMemberModal() {
        document.getElementById('memberModal').style.display = 'none';
        currentEditingId = null;
        document.getElementById('memberForm').reset();
        document.getElementById('imagePreview').style.display = 'none';
    }
    // Handle form submission
    async function handleFormSubmit(event) {
        event.preventDefault();

        const formData = new FormData();

        // Add all form fields to FormData
        formData.append('fullName', document.getElementById('fullName').value);
        formData.append('phone', document.getElementById('phone').value);
        formData.append('membershipType', document.getElementById('membershipType').value);
        formData.append('status', document.getElementById('status').checked);

        // Add image file if selected
        const imageFile = document.getElementById('imageFile').files[0];
        if (imageFile) {
            formData.append('imageFile', imageFile);
        }

        try {
            let response;
            let url;

            if (currentEditingId) {
                // Update existing member
                url = `/api/members/${currentEditingId}`;
                response = await fetch(url, {
                    method: 'PUT',
                    body: formData
                });
            } else {
                // Create new member
                url = '/api/members';
                response = await fetch(url, {
                    method: 'POST',
                    body: formData
                });
            }

            if (response.ok) {
                closeMemberModal();

                // Reload the page to see the updated members list
                window.location.reload();

                showNotification('success', 'نجاح',
                    currentEditingId ? 'تم تحديث العضو بنجاح!' : 'تم إنشاء العضو بنجاح!');
            } else {
                // Check if it's a duplicate phone number error
                if (response.status === 409) {
                    const errorData = await response.json();
                    showNotification('error', 'خطأ',
                        `رقم الهاتف مستخدم بالفعل: ${errorData.message || 'رقم الهاتف مستخدم من قبل عضو آخر'}`);
                } else {
                    const errorText = await response.text();
                    throw new Error(errorText || `Server returned ${response.status}: ${response.statusText}`);
                }
            }
        } catch (error) {
            console.error('Error saving member:', error);

            // Don't show the generic error for duplicate phone numbers as we already handled it
            if (!error.message.includes('رقم الهاتف مستخدم')) {
                showNotification('error', 'خطأ', 'فشل في حفظ العضو: ' + error.message);
            }
        }
    }
    // Delete a member
    async function deleteMember(id) {
        if (!confirm('هل أنت متأكد أنك تريد حذف هذا العضو؟')) {
            return;
        }

        try {
            showNotification('info', 'معلومات', 'جاري حذف العضو...');

            const response = await fetch(`/api/members/${id}`, {
                method: 'DELETE'
            });

            if (response.ok) {
                // Reload the page to see the updated members list
                window.location.reload();
                showNotification('success', 'نجاح', 'تم حذف العضو بنجاح!');
            } else {
                throw new Error(`Server returned ${response.status}: ${response.statusText}`);
            }
        } catch (error) {
            console.error('Error deleting member:', error);
            showNotification('error', 'خطأ', 'فشل في حذف العضو: ' + error.message);
        }
    }

    // View member profile in modal
    async function viewMemberProfile(id) {
        try {
            showProfileLoading(true);

            // Load member data
            const memberResponse = await fetch(`/api/members/${id}`);
            if (!memberResponse.ok) {
                throw new Error(`Failed to fetch member: ${memberResponse.status}`);
            }
            profileMemberData = await memberResponse.json();

            // Load workout sessions
            const sessionsResponse = await fetch(`/api/workout-sessions/member/${id}`);
            if (sessionsResponse.ok) {
                profileWorkoutSessions = await sessionsResponse.json();
                filteredSessions = [...profileWorkoutSessions];
            } else {
                console.error('Failed to fetch workout sessions:', sessionsResponse.status);
                profileWorkoutSessions = [];
                filteredSessions = [];
            }

            // Load member offers
            const offersResponse = await fetch(`/api/member-offers/member/${id}/active`);
            if (offersResponse.ok) {
                profileMemberOffers = await offersResponse.json();
            } else {
                console.error('Failed to fetch member offers:', offersResponse.status);
                profileMemberOffers = [];
            }

            // Render the profile
            renderProfileModal();
            filterSessionsByDate();
            openProfileModal();

        } catch (error) {
            console.error('Error loading member profile:', error);
            showNotification('error', 'خطأ', 'فشل في تحميل الملف الشخصي للعضو');
        } finally {
            showProfileLoading(false);
        }
    }

    // Show/hide profile loading spinner
    function showProfileLoading(show) {
        const spinner = document.getElementById('profileLoadingSpinner');
        const tableBody = document.getElementById('sessionsTableBody');

        if (spinner) {
            spinner.style.display = show ? 'block' : 'none';
        }

        if (show) {
            tableBody.innerHTML = `
                <tr>
                    <td colspan="2" style="text-align: center;">
                        <div class="spinner"></div>
                        <div>جاري تحميل الجلسات...</div>
                    </td>
                </tr>
            `;
        }
    }

    // Render profile modal
    function renderProfileModal() {
        if (!profileMemberData) return;
        const addSessionButton = document.querySelector('.btn-success.btn-sm');
        addSessionButton.disabled = false;
        addSessionButton.title = "إضافة جلسة";
        addSessionButton.classList.remove('disabled');

        // Set profile image
        const profileImage = document.getElementById('profileImage');
        if (profileMemberData.imageUrl) {
            profileImage.innerHTML = `<img src="${profileMemberData.imageUrl}" alt="${profileMemberData.fullName}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
        } else {
            profileImage.innerHTML = '<i class="fas fa-user"></i>';
        }

        // Set profile details
        document.getElementById('profileName').textContent = profileMemberData.fullName || 'غير متاح';
        document.getElementById('profileId').textContent = profileMemberData.id || 'غير متاح';
        document.getElementById('profilePhone').textContent = profileMemberData.phone || 'غير متاح';
        document.getElementById('profileJoinDate').textContent = profileMemberData.joinDate || 'غير متاح';

        // Set status
        const statusElement = document.getElementById('profileStatus');
        if (profileMemberData.status) {
            statusElement.innerHTML = '<span class="status-badge status-active">نشط</span>';
        } else {
            statusElement.innerHTML = '<span class="status-badge status-inactive">غير نشط</span>';
        }

        // Set membership type
        const membershipElement = document.getElementById('profileMembership');
        const membershipType = profileMemberData.membershipType || 'NORMAL';
        membershipElement.innerHTML = `<span class="membership-badge membership-${membershipType}">${membershipType === 'NORMAL' ? 'عادي' : membershipType === 'PREMIUM' ? 'مميز' : 'VIP'}</span>`;

        // Render subscription info
        renderProfileSubscriptionInfo();

        // Render workout sessions
        renderProfileWorkoutSessions();
    }

    // Render subscription information in profile modal
    function renderProfileSubscriptionInfo() {
        const activeOffer = profileMemberOffers.length > 0 ? profileMemberOffers[0] : null;

        if (!activeOffer) {
            document.getElementById('subscriptionOffer').textContent = 'لا يوجد اشتراك نشط';
            document.getElementById('subscriptionStart').textContent = '-';
            document.getElementById('subscriptionEnd').textContent = '-';
            document.getElementById('subscriptionRemaining').textContent = '-';
            document.getElementById('subscriptionStatus').textContent = 'لا يوجد';
            document.querySelector('.subscription-card').style.opacity = '0.7';
            return;
        }

        document.getElementById('subscriptionOffer').textContent = activeOffer.offer ? activeOffer.offer.title : `العرض #${activeOffer.offerId}`;
        document.getElementById('subscriptionStart').textContent = activeOffer.startDate || '-';
        document.getElementById('subscriptionEnd').textContent = activeOffer.endDate || '-';
        document.getElementById('subscriptionRemaining').textContent = activeOffer.remainedSessions !== undefined ? activeOffer.remainedSessions : '-';
        document.getElementById('subscriptionPrice').textContent = activeOffer.offer ? activeOffer.offer.price : '-';

        const statusElement = document.getElementById('subscriptionStatus');
        statusElement.textContent = activeOffer.status || '-';

        // Add color coding based on status
        if (activeOffer.status === 'ACTIVE') {
            statusElement.style.backgroundColor = 'rgba(76, 201, 240, 0.3)';
        } else if (activeOffer.status === 'EXPIRED') {
            statusElement.style.backgroundColor = 'rgba(229, 56, 59, 0.3)';
        } else if (activeOffer.status === 'CANCELLED') {
            statusElement.style.backgroundColor = 'rgba(108, 117, 125, 0.3)';
        }
    }

    // Render workout sessions in profile modal
    function renderProfileWorkoutSessions() {
        const tableBody = document.getElementById('sessionsTableBody');
        const addSessionButton = document.querySelector('.btn-success.btn-sm');
        if (!filteredSessions || !Array.isArray(filteredSessions)) {
            tableBody.innerHTML = '<tr><td colspan="3" class="error-message">تنسيق بيانات الجلسات غير صالح</td></tr>';
            addSessionButton.disabled = false;
            addSessionButton.title = "إضافة جلسة";
            addSessionButton.classList.remove('disabled');
            return;
        }

        if (filteredSessions.length === 0) {
            tableBody.innerHTML = `
            <tr>
                <td colspan="3" style="text-align: center; padding: 30px;">
                    <i class="fas fa-dumbbell" style="font-size: 3rem; opacity: 0.3; margin-bottom: 15px; display: block;"></i>
                    <div>لم يتم العثور على جلسات تمرين</div>
                </td>
            </tr>`;
            addSessionButton.disabled = false;
            addSessionButton.title = "إضافة جلسة";
            addSessionButton.classList.remove('disabled');
            return;
        }

        tableBody.innerHTML = '';

        // Sort sessions by date (newest first)
        const sortedSessions = [...filteredSessions].sort((a, b) =>
            new Date(b.sessionDate) - new Date(a.sessionDate)
        );

        // Get active offer for remaining sessions calculation
        const activeOffer = profileMemberOffers.length > 0 ? profileMemberOffers[0] : null;
        // Get reference to the Add Session button


// Flag to track if current date exists in sessions
        let hasCurrentDateSession = false;

        sortedSessions.forEach((session, index) => {
            const row = document.createElement('tr');

            // Calculate remaining sessions for this date
            const remainingSessions = session?.remainedSessions;

            // Determine CSS class for remaining sessions
            let remainingClass = 'remaining-high';
            if (remainingSessions <= 3) {
                remainingClass = 'remaining-low';
            } else if (remainingSessions <= 7) {
                remainingClass = 'remaining-medium';
            }

            // Format session date for comparison
            const sessionDateFormatted = formatDate(session.sessionDate);

            // Get current date in the same format
            const currentDate = new Date();
            const currentDateFormatted = formatDate(currentDate);

            // Check if session date equals current date
            if (sessionDateFormatted === currentDateFormatted) {
                hasCurrentDateSession = true;
            }

            row.innerHTML = `
        <td class="session-date">${sessionDateFormatted || 'غير متاح'}</td>
        <td><span class="remaining-sessions ${remainingClass}">${remainingSessions}</span></td>
        <td class="session-actions-cell">
            <button class="btn-icon btn-delete" onclick="deleteWorkoutSession(${session.id})" title="حذف الجلسة">
                <i class="fas fa-trash"></i>
            </button>
        </td>
    `;

            tableBody.appendChild(row);
        });

// Disable or enable the Add Session button based on whether current date exists
        if (hasCurrentDateSession) {
            addSessionButton.disabled = true;
            addSessionButton.title = "لا يمكن إضافة أكثر من جلسة واحدة في اليوم";
            addSessionButton.classList.add('disabled');
        } else {
            addSessionButton.disabled = false;
            addSessionButton.title = "إضافة جلسة";
            addSessionButton.classList.remove('disabled');
        }
    }


    // Function to delete a workout session
    function deleteWorkoutSession(sessionId) {
        if (confirm('هل أنت متأكد أنك تريد حذف جلسة التمرين هذه؟')) {
            // Show loading state
            const notification = showNotification('جاري حذف الجلسة...', 'info');

            // Make API call to delete the session
            fetch(`/api/workout-sessions/${sessionId}`, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                },
            })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Failed to delete session');
                    }
                    return response.json();
                })
                .then(data => {
                    // Remove the session from the filteredSessions array
                    filteredSessions = filteredSessions.filter(session => session.id !== sessionId);

                    // Re-render the sessions table
                    renderProfileWorkoutSessions();

                    // Show success message
                    showNotification('تم حذف الجلسة بنجاح', 'success');

                    // You might also want to refresh the subscription details
                    // since remaining sessions count may have changed
                    if (currentMemberId) {
                        loadMemberOffers(currentMemberId);
                    }
                })
                .catch(error => {
                    console.error('Error deleting workout session:', error);
                    showNotification('فشل في حذف الجلسة: ' + error.message, 'error');
                })
                .finally(() => {
                    // Remove the loading notification if needed
                });
        }
    }

    // Filter sessions by date range
    function filterSessionsByDate() {
        const startDate = document.getElementById('startDateFilter').value;
        const endDate = document.getElementById('endDateFilter').value;

        if (!startDate || !endDate) {
            filteredSessions = [...profileWorkoutSessions];
        } else {
            const start = new Date(startDate);
            const end = new Date(endDate);
            end.setHours(23, 59, 59, 999); // Include the entire end date

            filteredSessions = profileWorkoutSessions.filter(session => {
                const sessionDate = new Date(session.sessionDate);
                return sessionDate >= start && sessionDate <= end;
            });
        }

        renderProfileWorkoutSessions();
    }

    function formatDate(dateString) {
        if (!dateString) return 'غير متاح';

        try {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-CA'); // 'en-CA' locale gives yyyy-MM-dd format
        } catch (e) {
            return dateString;
        }
    }
    // Calculate remaining sessions for a specific date
    function calculateRemainingSessions(sessionDate, activeOffer, allSessions, currentIndex) {
        if (!activeOffer) return 'غير متاح';

        // Find the index of this session in the sorted array
        const sessionIndex = allSessions.findIndex(s => s.sessionDate === sessionDate);

        if (sessionIndex === -1) return activeOffer.remainedSessions || 0;

        // Count how many sessions happened after this one
        const sessionsAfterThis = allSessions.length - sessionIndex - 1;

        // Calculate remaining sessions: initial sessions minus sessions used after this one
        const remaining = (activeOffer.remainedSessions || 0) + sessionsAfterThis;
        return remaining >= 0 ? remaining : 0;
    }

    // Open profile modal
    function openProfileModal() {
        document.getElementById('memberProfileModal').style.display = 'block';
    }

    // Close profile modal
    function closeProfileModal() {
        document.getElementById('memberProfileModal').style.display = 'none';
        // Reset profile data
        profileMemberData = null;
        profileWorkoutSessions = [];
        profileMemberOffers = [];
        filteredSessions = [];
    }

    // Open create workout session modal
    function openCreateWorkoutSessionModal() {
        if (!profileMemberData) return;

        document.getElementById('workoutSessionMemberId').value = profileMemberData.id;
        document.getElementById('sessionDate').valueAsDate = new Date();
        document.getElementById('createWorkoutSessionModal').style.display = 'block';
    }

    // Close create workout session modal
    function closeCreateWorkoutSessionModal() {
        document.getElementById('createWorkoutSessionModal').style.display = 'none';
        document.getElementById('workoutSessionForm').reset();
    }

    // Handle workout session form submission
    async function handleWorkoutSessionSubmit(event) {
        event.preventDefault();

        const memberId = document.getElementById('workoutSessionMemberId').value;
        const sessionDate = document.getElementById('sessionDate').value;

        try {
            const response = await fetch('/api/workout-sessions', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    memberId: parseInt(memberId),
                    sessionDate: sessionDate
                })
            });

            if (response.ok) {
                closeCreateWorkoutSessionModal();
                showNotification('success', 'Success', 'Workout session created successfully!');

                // Reload the profile to see the updated sessions
                await viewMemberProfile(parseInt(memberId));
            } else {
                const errorText = await response.text();
                throw new Error(errorText || `Server returned ${response.status}: ${response.statusText}`);
            }
        } catch (error) {
            console.error('Error creating workout session:', error);
            showNotification('error', 'Error', 'Failed to create workout session: ' + error.message);
        }
    }

    // Open create member offer modal
    async function openCreateMemberOfferModal() {
        if (!profileMemberData) return;

        try {
            // Load available offers
            const response = await fetch('/api/offers');
            if (response.ok) {
                allOffers = await response.json();

                // Check if offers array is empty
                if (!allOffers || allOffers.length === 0) {
                    showNotification('warning', 'No Offers', 'No offers available. Please create offers first.');
                    return;
                }

                // DEBUG: Check what fields actually exist
                console.log('First offer object:', allOffers[0]);
                console.log('Available fields:', allOffers[0] ? Object.keys(allOffers[0]) : 'No offers found');

                const offerSelect = document.getElementById('offerId');
                offerSelect.innerHTML = '<option value="">Select an offer</option>';

                allOffers.forEach(offer => {
                    const option = document.createElement('option');
                    option.value = offer.id;

                    // Use safe property access with fallbacks
                    const title = offer.title || offer.name || 'No Title';
                    const sessions = offer.numberOfSessions || offer.sessions || offer.numberOfSession || 0;
                    const price = offer.price || 0;
                    const months = offer.numberOfMonths || offer.months || 0;

                    option.textContent = `${title} - ${sessions} sessions - $${price.toFixed(2)}`;
                    option.setAttribute('data-sessions', sessions);
                    option.setAttribute('data-months', months);
                    option.setAttribute('data-price', price);
                    offerSelect.appendChild(option);
                });

                document.getElementById('memberOfferMemberId').value = profileMemberData.id;

                // Set default dates (today and based on offer months)
                const today = new Date();

                // Set today as the start date
                document.getElementById('memberOfferStartDate').valueAsDate = today;

                // Initially set end date to 30 days from now as fallback
                const defaultEndDate = new Date();
                defaultEndDate.setDate(today.getDate() + 30);
                document.getElementById('memberOfferEndDate').valueAsDate = defaultEndDate;

                // Add event listener to update dates when offer selection changes
                offerSelect.addEventListener('change', function (message) {
                    const selectedOption = this.options[this.selectedIndex];

                    if (selectedOption.value) {
                        const months = parseInt(selectedOption.getAttribute('data-months'));
                        const startDate = new Date();

                        // Calculate end date based on months in offer
                        const endDate = new Date();
                        endDate.setMonth(startDate.getMonth() + months);
                        alert("End data from if : ", endDate)
                        // Update the date fields
                        document.getElementById('memberOfferStartDate').valueAsDate = startDate;
                        document.getElementById('memberOfferEndDate').valueAsDate = endDate;
                    } else {
                        // Reset to defaults if no offer selected
                        const today = new Date();
                        const in30Days = new Date();
                        in30Days.setDate(today.getDate() + 30);
                        alert("End date from else : ", in30Days)
                        document.getElementById('memberOfferStartDate').valueAsDate = today;
                        document.getElementById('memberOfferEndDate').valueAsDate = in30Days;
                    }
                });

                document.getElementById('createMemberOfferModal').style.display = 'block';
            } else {
                throw new Error(`Failed to fetch offers: ${response.status}`);
            }
        } catch (error) {
            console.error('Error loading offers:', error);
            showNotification('error', 'Error', 'Failed to load offers: ' + error.message);
        }
    }

    // Close create member offer modal
    function closeCreateMemberOfferModal() {
        document.getElementById('createMemberOfferModal').style.display = 'none';
        document.getElementById('memberOfferForm').reset();
    }

    // Handle member offer form submission
    async function handleMemberOfferSubmit(event) {
        event.preventDefault();

        const memberId = document.getElementById('memberOfferMemberId').value;
        const offerId = document.getElementById('offerId').value;
        const startDate = document.getElementById('memberOfferStartDate').value;
        const endDate = document.getElementById('memberOfferEndDate').value;
        const remainedSessions = document.getElementById('remainedSessions').value;

        try {
            const response = await fetch('/api/member-offers', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    memberId: parseInt(memberId),
                    offerId: parseInt(offerId),
                    startDate: startDate,
                    endDate: endDate,
                    remainedSessions: parseInt(remainedSessions),
                    status: 'ACTIVE'
                })
            });

            if (response.ok) {
                closeCreateMemberOfferModal();
                showNotification('success', 'Success', 'Member offer created successfully!');

                // Reload the profile to see the updated offer
                await viewMemberProfile(parseInt(memberId));
            } else {
                const errorText = await response.text();
                throw new Error(errorText || `Server returned ${response.status}: ${response.statusText}`);
            }
        } catch (error) {
            console.error('Error creating member offer:', error);
            showNotification('error', 'Error', 'Failed to create member offer: ' + error.message);
        }
    }

    // Close modal if clicked outside
    window.onclick = function(event) {
        const modal = document.getElementById('memberModal');
        const profileModal = document.getElementById('memberProfileModal');
        const workoutSessionModal = document.getElementById('createWorkoutSessionModal');
        const memberOfferModal = document.getElementById('createMemberOfferModal');

        if (event.target === modal) {
            closeMemberModal();
        }

        if (event.target === profileModal) {
            closeProfileModal();
        }

        if (event.target === workoutSessionModal) {
            closeCreateWorkoutSessionModal();
        }

        if (event.target === memberOfferModal) {
            closeCreateMemberOfferModal();
        }
    };

</script>
<script>
    // Define navigation and footer templates directly in JavaScript
    const navigationTemplate = `
            <header>
                <div class="container">
                    <nav>
                        <a href="/" class="logo">
                            <i class="fas fa-dumbbell"></i>
                            <span>BOB Gym</span>
                        </a>

                        <button class="menu-toggle" id="menuToggle">
                            <span></span>
                            <span></span>
                            <span></span>
                        </button>

                        <div class="nav-links" id="navLinks">
                            <a href="/">Home</a>
                            <a href="/members">Members</a>
                            <a href="/offers">Offers</a>
                            <a href="#">Classes</a>
                            <a href="#">Trainers</a>
                            <a href="#">Contact</a>
                        </div>
                    </nav>
                </div>
            </header>
        `;

    const footerTemplate = `
            <footer>
                <div class="container">
                    <div class="footer-content">
                        <div class="footer-column">
                            <h3>BOB Gym Management</h3>
                            <p>Providing cutting-edge gym management solutions to help fitness businesses thrive in the digital age.</p>
                            <div class="social-links">
                                <a href="#"><i class="fab fa-facebook-f"></i></a>
                                <a href="#"><i class="fab fa-twitter"></i></a>
                                <a href="#"><i class="fab fa-instagram"></i></a>
                                <a href="#"><i class="fab fa-linkedin-in"></i></a>
                            </div>
                        </div>

                        <div class="footer-column">
                            <h3>Quick Links</h3>
                            <ul class="footer-links">
                                <li><a href="/">Home</a></li>
                                <li><a href="/members">Members</a></li>
                                <li><a href="/offers">Offers</a></li>
                                <li><a href="#">Trainers</a></li>
                                <li><a href="#">Pricing</a></li>
                            </ul>
                        </div>

                        <div class="footer-column">
                            <h3>Resources</h3>
                            <ul class="footer-links">
                                <li><a href="#">Blog</a></li>
                                <li><a href="#">Documentation</a></li>
                                <li><a href="#">Support Center</a></li>
                                <li><a href="#">API Documentation</a></li>
                            </ul>
                        </div>

                        <div class="footer-column">
                            <h3>Contact Us</h3>
                            <p><i class="fas fa-map-marker-alt"></i> 123 Fitness Street, Health City</p>
                            <p><i class="fas fa-phone"></i> +1 (555) 123-4567</p>
                            <p><i class="fas fa-envelope"></i> info@bobgym.com</p>
                        </div>
                    </div>

                    <div class="copyright">
                        <p>&copy; 2024 BOB Gym Management System. All rights reserved.</p>
                    </div>
                </div>
            </footer>
        `;

    // Function to load navigation
    function loadNavigation() {
        // Try to fetch from server first
        document.getElementById('navbar').innerHTML = navigationTemplate;

        // fetch('/navigation')
        //     .then(response => {
        //         if (!response.ok) {
        //             throw new Error('Navigation file not found');
        //         }
        //         return response.text();
        //     })
        //     .then(data => {
        //         document.getElementById('navbar').innerHTML = data;
        //         initNavigation();
        //     })
        //
        //     .catch(error => {
        //         console.log('Using embedded navigation template');
        //         // Use the embedded template if fetch fails
        //         document.getElementById('navbar').innerHTML = navigationTemplate;
        //         initNavigation();
        //     });
    }

    // Function to load footer
    function loadFooter() {
        // Try to fetch from server first
        fetch('/footer.html')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Footer file not found');
                }
                return response.text();
            })
            .then(data => {
                document.getElementById('footer').innerHTML = data;
            })
            .catch(error => {
                console.log('Using embedded footer template');
                // Use the embedded template if fetch fails
                document.getElementById('footer').innerHTML = footerTemplate;
            });
    }

    // Initialize navigation functionality
    function initNavigation() {
        // Mobile menu toggle
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });
        }

        // Highlight current page in navigation
        const currentLocation = window.location.pathname;
        const navItems = document.querySelectorAll('.nav-links a');

        navItems.forEach(item => {
            const itemPath = item.getAttribute('href');

            // Handle root path
            if (currentLocation === '/' && itemPath === '/') {
                item.classList.add('active');
                return;
            }

            // Handle other paths
            if (currentLocation !== '/' && itemPath !== '/' && currentLocation.includes(itemPath)) {
                item.classList.add('active');
            } else if (currentLocation !== itemPath) {
                item.classList.remove('active');
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', (e) => {
            if (navLinks && navLinks.classList.contains('active') &&
                !e.target.closest('.nav-links') &&
                !e.target.closest('.menu-toggle')) {
                navLinks.classList.remove('active');
                menuToggle.classList.remove('active');
            }
        });
    }

    // Load components when page is ready
    document.addEventListener('DOMContentLoaded', function() {
        loadNavigation();
        loadFooter();
        console.log('BOB Gym Management System loaded successfully');
    });
</script>
</body>
</html>